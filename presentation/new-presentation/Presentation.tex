\documentclass{beamer}
\mode<presentation>{
  \usetheme{boxes}
}


\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[swedish]{babel}
\usepackage{epstopdf}
\usepackage{array}

\usepackage{listings}
\usepackage{graphics}
\usepackage{tikz}
\usepackage{comment}
\usetikzlibrary{trees,arrows,automata}

\usepackage{wasysym}
\usepackage{fancyvrb}
\DefineVerbatimEnvironment{code}{Verbatim}{fontsize=\small}
\DefineVerbatimEnvironment{example}{Verbatim}{fontsize=\small}
\newcommand{\ignore}[1]{
}

\lstnewenvironment{codeEx}
{\lstset{ basicstyle= \ttfamily }}
{}

\lstnewenvironment{codeExDiff}
{\lstset{ basicstyle=\color{black} \ttfamily
        , moredelim=[is][\color{red}]{|}{|}
        } }
{}

\newcommand{\sepFrame}[1] {
\begin{frame}
\begin{center}
	\Huge{#1}
\end{center}
\end{frame}
}

\newcommand{\ndist}{1.7cm}
\newcommand{\nshift}{0.6cm}
\newcommand{\nshiftw}{0.9cm}
\newcommand{\ncol}{blue!20!white}

\newcommand{\tree}[5] {
\begin{figure}[H]
    \centering
        \begin{tikzpicture}[->,node distance=\ndist, semithick]
            \tikzstyle{every state}=[fill=red!20!white,text=black]
            \node[state,fill=\ncol](add) {#2};
            \node[state,fill=\ncol](mul)[below of=add, xshift=\nshiftw] {#3};
            \node[state,fill=\ncol](sin)[below of=add, xshift=-\nshiftw] {#1};
            \node[state](x1)  [below of=sin, xshift=0cm] {#4};
            \node[state](x2)  [below of=mul, xshift=-\nshift]  {#4};
            \node[state](five)[below of=mul, xshift=\nshift]  {#5};
            \path (add) edge node {} (mul)
                        edge node {} (sin)
                  (mul) edge node {} (x2)
                        edge node {} (five)
                  (sin) edge node {} (x1);
        \end{tikzpicture}
\end{figure}

}

\newcommand{\haskellcol}{red!20!white}
\newcommand{\ourcol}    {blue!20!white}
\newcommand{\stgcol}    {purple!20!white}
\newcommand{\runcol}    {green!20!white}


\usepackage{listings}
\usepackage{tikz}

\lstset{escapechar=\%}

\tikzstyle{every picture}+=[remember picture]
\tikzstyle{na} = [baseline=-.5ex]



\begin{document}

\title{Optimering under körningstid}

\author{Simon Edwardsson \and Olle Fredriksson
\and \linebreak{}
Daniel Gustafsson \and Dan Rosén}


\institute{Chalmers Tekniska Högskola\and Göteborgs Universitet}

\everymath{\displaystyle}

\begin{frame}
    \titlepage
\end{frame}


\begin{frame}
\begin{figure}[H]
\centering
    \includegraphics[width=0.9\textwidth]{img/interface.pdf} 
\end{figure}

\end{frame}

\begin{frame}[fragile]
\centering
\begin{tabular}{ m{2.4cm} m{0.5cm} m{5cm} }
    sin(x) + x * 5 &  $\Rightarrow$
    &
	\tree{sin}{+}{*}{x}{5}
\\
\end{tabular}
\end{frame}

\begin{frame}[fragile]
\centering
\begin{tabular}{ m{2.4cm} m{0.5cm} m{5cm} }
    sin(x) + x * 5 & $\Rightarrow$
    &
	\tree{Sin}{Add}{Mul}{Var}{Num}
\\
\end{tabular}
\end{frame}

\begin{frame}[fragile]
\centering
\begin{tabular}{ m{10cm} }
\tree{Sin}{Add}{Mul}{Var}{Num} \\
\begin{codeEx}
eval :: Expr -> Double -> Double
eval (Add l r) x = eval l x + eval r x 
eval (Sin e)   x = sin (eval e x)
eval Var       x = x
..
\end{codeEx}
% eval (Num n)   x = n
% eval (Mul l r) x = eval l x * eval r x
\\
\end{tabular}
\end{frame}

\begin{frame}[fragile]

%Bild på en graf, där vi visar att det finns många olika x värden. Här säger vi också att det finns ett problem.
\begin{codeEx}
map (eval expr) [-10..10]
\end{codeEx}

\end{frame}

\begin{frame}[fragile] 
\begin{codeExDiff}
map (|optimise| (eval expr)) [-10..10]
\end{codeExDiff}

\pause

\verb|eval' :: Double -> Double|
\verb|eval' x = eval (Add (Sin Var) (Mul Var (Num 5))) x|
\pause
\verb|eval' x = eval (Sin Var) x + eval (Mul Var (Num 5)) x|
\pause
\verb|eval' x = sin (eval Var x) + eval (Mul Var (Num 5)) x|
\pause
\verb|eval' x = sin x + eval (Mul Var (Num 5)) x |
\pause
\verb|...                          |

\verb|eval' x = sin x + x * 5|
%\end{verbatim}

\pause

\begin{codeExDiff}
map |eval'| [-10..10]
\end{codeExDiff}
\end{frame}

\sepFrame{Demo}


% knyta an till f;rra presentationen utan att utesluta de nya, kort namna att vi optimerar saker och forklarar ett vi nu ska ge ett exempel dar det ar anvandbart


\begin{frame}

	%Vad sysslar vi egentligen med (vart befinner vi oss) (graf fran olle) 
	\begin{figure}[H]
        \begin{tikzpicture}[scale=0.5,transform shape,->,rounded corners
                           ,auto,node distance=3.2cm, semithick]
        \tikzstyle{every state}=[fill=\haskellcol
                                ,rectangle
                                ,minimum size=2.0cm]
        \node<1->[state](haskell)[]                   {Haskell};
        \node<2->[state,fill=\stgcol](stg)    [below of=haskell]                   {STG-kod};
        \node<3->[state,fill=\ourcol](socker) [left of=stg]        {Sockerkod};
        \node<4->[state,fill=\runcol](int) [right of=stg,xshift=3.0cm] {
          \begin{tikzpicture}[semithick]
            \node<4->[state,fill=\ourcol](stgint) [right of=stg]       {STG-tolk};
            \node<5->[state,fill=\ourcol](opt)    [right of=stgint]    {Optimering};
            \path<5->
              (stgint) edge[bend left] node {} (opt)
              (opt)    edge[bend left] node {} (stgint);
          \end{tikzpicture}
          Körning
        };
        \path<3-> (socker) edge            node {} (stg);
        \path<4-> (stg)    edge            node {} (int);
        \path<2-> (haskell) edge           node {} (stg);
    \end{tikzpicture}
\end{figure}

\end{frame}

\sepFrame{Användningsområden}

\begin{frame}
%\frametitle{Användningsområden}

\begin{tabular}{ m{5.5cm} m{4cm} }

\begin{itemize}
	\item Regular expressions
	\item Vetenskapliga beräkningar % dotproduct, power, newtonraphson, simuleringar
	\item Raytracer
\end{itemize}
&
\begin{figure}[H]
\centering
    \includegraphics[width=0.3\textwidth]{img/metod.png} 
\end{figure}

\end{tabular}


\end{frame}

\begin{frame}
\begin{figure}[H]
\centering
    \includegraphics[width=1\textwidth]{img/Ray_trace_diagram.pdf} 
\end{figure}

\end{frame}
\begin{frame}

\begin{figure}[H]
\centering
    \includegraphics[width=0.6\textwidth]{img/shapes.png} 
\end{figure}


\end{frame}
\begin{frame}
\begin{figure}[H]
\includegraphics[width=1\textwidth]{shapesnormnocb.eps}
\end{figure}


\end{frame}

\begin{comment}
\begin{frame}

	Gobby 

\end{frame}
\end{comment}

\sepFrame{Nytt}

\begin{frame}[fragile]
%Lathet

\begin{tabular}{ m{5cm} m{9cm} }


\begin{figure}[H]
\centering
    \includegraphics[width=0.6\textwidth]{img/cat.jpg} 
\end{figure}
&
\begin{codeEx}
fact x = if (x == 0) 
    then 1
    else x * fact (x - 1)
\end{codeEx}
 
\\
\end{tabular}

\end{frame}

\begin{frame}[fragile]
%		Anropsstack
\begin{lstlisting}
roots a b c =
    (-%\tikz[na] \coordinate(b1);%b + sqrt (b%\tikz[na] \coordinate(b2);% * b%\tikz[na] \coordinate(b3);% - 4 * a%\tikz[na] \coordinate(a1);% * c%\tikz[na] \coordinate(c1);%)) / (2 * %\tikz[na] \coordinate(a2);%a)

\end{lstlisting}
\ \\[2cm]
\pause
\begin{center}
\tikz\node [baseline,draw] (a) {2};
\tikz\node [baseline,draw] (b) {5};
\tikz\node [baseline,draw] (c) {3};
\end{center}

\begin{tikzpicture}[overlay]
\path<3>[->, red] (a1) edge [bend left=8] (a);
\path<3>[->, red] (a2) edge [bend left=-20] (a);
\path<4>[->, blue] (b1) edge [bend left=-90] (b);
\path<4>[->, blue] (b2) edge [bend right=-20] (b);
\path<4>[->, blue] (b3) edge [bend right=-20] (b);
\path<5>[->, green] (c1) edge [bend left] (c);
\end{tikzpicture}


\end{frame}



\begin{frame}[fragile]

%\frametitle{Delning}

\begin{codeEx}

power 0 x = 1
power n x
    | even n = let a = power (n / 2) x
               in  a * a
    | otherwise = x * power (n - 1) x

\end{codeEx}

\end{frame} 

\sepFrame{Framtid}

\begin{frame}
\begin{figure}[H]
        \begin{tikzpicture}[scale=0.5,transform shape,->,rounded corners
                           ,auto,node distance=3.2cm, semithick]
        \tikzstyle{every state}=[fill=\haskellcol
                                ,rectangle
                                ,minimum size=2.0cm]
        \node[state](haskell)[]                   {Haskell};
        \node[state,fill=\stgcol](stg)    [below of=haskell]                   {STG-kod};
        \node[state,fill=\ourcol](socker) [left of=stg]        {Sockerkod};
        \node[state,fill=\runcol](int) [right of=stg,xshift=3.0cm] {
          \begin{tikzpicture}[semithick]
            \node[state,fill=\ourcol](stgint) [right of=stg]       {STG-tolk};
            \node[state,fill=\ourcol](opt)    [right of=stgint]    {Optimering};
            \path
              (stgint) edge[bend left] node {} (opt)
              (opt)    edge[bend left] node {} (stgint);
          \end{tikzpicture}
          Körning
        };
        \node<2->[state](comp)   [below of=stg]       {Kompilering};
        \node<3->[state,fill=\runcol](run)    [below of=comp]      {
          \begin{tikzpicture}[semithick]
            \node<3->[state](runinner) [] {Körbart program};
            \node<4->[state](optcomp)  [right of=runinner] {Optimering};
            \path<4->
              (runinner) edge[bend left] node {} (optcomp)
              (optcomp)  edge[bend left] node {} (runinner);
          \end{tikzpicture}
          Körning
        };
        \path (socker) edge            node {} (stg);
        \path (stg)    edge            node {} (int);
        \path<2-> (stg)    edge            node {} (comp);
        \path (haskell) edge           node {} (stg);
        \path<3-> (comp)   edge            node {} (run);
        \end{tikzpicture}
\end{figure}
\end{frame}

\end{document}
