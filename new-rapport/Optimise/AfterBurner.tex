\documentclass[../Optimise]{subfiles}
\begin{document}

\subsection{Afterburner}

Alla optimeringar har hittills i det här arbetet har arbetat tillsammans, i en gemensam
traversering av syntaxträdet som följer en gemensam semantik för att nå det önskade resultatet. 
Detta är bra ur tidssynpunkt men gör det ibland svårt att byta ut enskilda delar i koden
eftersom man då ofta behöver ändra på många ställen på samma gång.

Det finns även en del optimeringar som behöver se större delar av syntaxträdet
samtidigt för att kunna vara verksamma. Dessa optimeringar är som regel mycket långsammare att utföra.

Vi har valt att utföra ett antal sådana optimeringar efter att de vanliga
optimeringana har körts, därav namnet `after burner'. Följande regel beskriver
var i semantiken som afterburnern kommer in:

\begin{align*}
\CBNIRR{\cOFUN{\overline{as}}{\alpha}s}HAe \Rightarrow & \CBNMC{\alpha}{s}{\heap{\alpha}{obj}}A \\
 & \text{där } obj = \text{afterburn} (\FUN{\overline{as}}e)
\end{align*}

\subsubsection{Gemensam case-granskare}

Att \kw{case}:a på samma uttryck två gånger kommer i ett funktionellt språk alltid att ge
samma resultat då alla variabler egentligen är konstanter. För varje \kw{case}-gren
vi går in i vet vi att alla nästlade \kw{case} på samma uttryck måste välja samma
gren som den första.

\begin{codeEx}
test x = x * x
\end{codeEx}

Blir efter vanlig optimering

\begin{codeEx}
test x = case x of
            I# a -> case x of
                I# b -> case a #* b of
                    r' -> let r = I# r'
                            in r
\end{codeEx}

Om vi sedan kör optimeringen av gemensamma \kw{case}-granskare erhålls:
\begin{codeEx}
test x = case x of
            I# a -> case a #* b of
                r' -> let r = I# r'
                    in r
\end{codeEx}

Generellt:
		\begin{codeEx}
case x of
    C a b -> e1
    D a b -> e2
\end{codeEx}

Vi söker upp \ic{case x} i \ic{e1} och initierar 
\ic{C}-grenen med \ic{a} och \ic{b} som värden. I \ic{e2} gör vi samma sak fast initierar \ic{D}-grenen.


\end{document}
